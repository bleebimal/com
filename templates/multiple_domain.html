<link
  href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
  rel="stylesheet"
  id="bootstrap-css"
/>

<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>
  function refreshPage() {
    window.location.reload();
  }
</script>

<head>
  <title>Analyze</title>
  <link
    rel="stylesheet"
    href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
  />
  <style>
    .container {
      border: 2px solid blue;
      text-align: center;
      width: 550px;
      margin-top: -60px;
    }

    body {
      padding: 8% 14%;
      background-color: aliceblue;
    }

    h1 {
      margin: auto;
    }

    .banner {
      height: 90px;
      width: 546px;
      background-color: #0056b3;
    }

    input[type='file'] {
      height: 45px;
    }

    .input-group {
      margin: 0 0 10px 0;
    }
  </style>
</head>
<div class="text-center text-danger" style="font-weight: bold">
  {% if messages %} {% for message in messages %}
  <div
    class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}"
    role="alert"
  >
    {{ message }}
  </div>
  {% endfor %} {% endif %}
</div>

<div class="container">
  <div class="row">
    <div class="col-md-2">
      <a
        href="/main"
        class="btn btn-success float-left text-white btn-lg"
        style="margin: 10px; background-color: #00796b"
        >Home</a
      >
    </div>
    <div class="col-md-8">
      <h2 style="margin: 10px">Multiple Domain</h2>
    </div>
    <div class="col-md-2">
      <a
        href="/logout"
        class="btn btn-success float-right text-white btn-lg"
        style="margin: 10px; background-color: #00796b"
        >Logout</a
      >
    </div>
  </div>
  <div class="banner row">
    <h1><i class="fa fa-file-csv" aria-hidden="true"></i> CSV File Upload</h1>
  </div>
  <div
    class="alert alert-danger"
    style="margin-bottom: -10px; margin-top: 13px; display: none"
    id="error"
  ></div>
  <br />

  <form
    method="post"
    action="/multiple_domain_analyze/"
    enctype="multipart/form-data"
    id="multipleDomainForm"
  >
    {% csrf_token %}
    <div class="input-group">
      <div class="input-group-prepend">
        <span class="input-group-text"><i class="fa fa-file"></i></span>
      </div>
      <input type="file" id="file" name="file[]" class="form-control" />
      <div>
        <input
          type="text"
          name="technologyName[]"
          style="height: 100%; margin-left: 10px; width: 95%"
        />
      </div>
    </div>
    <div class="input-group">
      <div class="input-group-prepend">
        <span class="input-group-text"><i class="fa fa-file"></i></span>
      </div>
      <input type="file" id="file" name="file[]" class="form-control" />
      <div>
        <input
          type="text"
          name="technologyName[]"
          style="height: 100%; margin-left: 10px; width: 95%"
        />
      </div>
    </div>
    <div class="input-group">
      <div class="input-group-prepend">
        <span class="input-group-text"><i class="fa fa-file"></i></span>
      </div>
      <input type="file" id="file" name="file[]" class="form-control" />
      <div>
        <input
          type="text"
          name="technologyName[]"
          style="height: 100%; margin-left: 10px; width: 95%"
        />
      </div>
    </div>
    <div class="input-group">
      <div class="input-group-prepend">
        <span class="input-group-text"><i class="fa fa-file"></i></span>
      </div>
      <input type="file" id="file" name="file[]" class="form-control" />
      <div>
        <input
          type="text"
          name="technologyName[]"
          style="height: 100%; margin-left: 10px; width: 95%"
        />
      </div>
    </div>
    <div class="input-group">
      <div class="input-group-prepend">
        <span class="input-group-text"><i class="fa fa-file"></i></span>
      </div>
      <input type="file" id="file" name="file[]" class="form-control" />
      <div>
        <input
          type="text"
          name="technologyName[]"
          style="height: 100%; margin-left: 10px; width: 95%"
        />
      </div>
    </div>
    <div class="input-group">
      <div class="input-group-prepend">
        <span class="input-group-text"><i class="fa fa-file"></i></span>
      </div>
      <input type="file" id="file" name="file[]" class="form-control" />
      <div>
        <input
          type="text"
          name="technologyName[]"
          style="height: 100%; margin-left: 10px; width: 95%"
        />
      </div>
    </div>
    <div class="input-group">
      <div class="input-group-prepend">
        <span class="input-group-text"><i class="fa fa-file"></i></span>
      </div>
      <input type="file" id="file" name="file[]" class="form-control" />
      <div>
        <input
          type="text"
          name="technologyName[]"
          style="height: 100%; margin-left: 10px; width: 95%"
        />
      </div>
    </div>
    <br />
    <div
      class="row"
      style="
        height: auto !important;
        width: auto !important;
        background: none !important;
        margin: 0 auto;
      "
    >
      <div class="col-md-6">
        <button
          class="btn btn-success btn-lg"
          onclick="enable();"
          type="button"
          style="background-color: #00796b"
        >
          <span
            id="spinner"
            class="spinner-border spinner-border-sm"
            role="status"
            aria-hidden="true"
          ></span>
          Analyze
        </button>
      </div>
      <div class="col-md-6">
        <button
          id="stop"
          class="btn btn-danger btn-lg"
          onClick="refreshPage()"
          style="float: left; background-color: #00796b"
        >
          <span class="glyphicon glyphicon-off"></span> Stop
        </button>
      </div>
    </div>
  </form>
</div>

<script>
  String.prototype.capitalize = function () {
    return this.charAt(0).toUpperCase() + this.slice(1);
  };
  $(document).ready(function () {
    $('#stop').attr('disabled', true);
    $('#spinner').hide();
  });

  function enable() {
    var count = 0;
    $.each($('input:file'), function (index, value) {
      count += value.files.length;
    });
    if (count < 2) {
      return $('#error').text('Please add 2 or more CSV files').show();
    } else {
      $('#error').text('').hide();
      $('#multipleDomainForm').submit();
      $('#stop').attr('disabled', false);
      $('#spinner').show();
    }
  }

  // var count = 0;
  //   $.each($('input:file'), function (index, value) {
  //     count += value.files.length;
  //   });
  //   if (count < 2) {
  //     return $('#error').text('Please add 2 or more CSV files');

  $("[type='file']").on('change', function (e) {
    var filename = e.target.files[0].name
      .split('.')
      .slice(0, -1)
      .join('.')
      .capitalize();
    $(e.currentTarget).parent().find("[name='technologyName[]']").val(filename);
  });
</script>
